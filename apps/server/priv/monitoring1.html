<!DOCTYPE HTML>
<html>
        <head>
                <meta http-equiv="cache-control" content="max-age=0" />
                <meta http-equiv="cache-control" content="no-cache" />
                <meta http-equiv="expires" content="0" />
                <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
                <meta http-equiv="pragma" content="no-cache" />
                <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
                <meta charset="utf-8">
        </head>
        <body>
                <div id="tester" style="width:600px;height:250px;"></div>
<div id="metrics"></div>
                <script>
var host = window.location.host;
var metricsList;

function getMetricsList(){
    var xhr = new XMLHttpRequest();
    var result;
    xhr.open("GET", "https://" + host + "/v1/monitoring/list", false);
    xhr.onloadend = (e) => {result = JSON.parse(e.target.response);};
    xhr.send();
    return result;
}

function getMetric(Name){
    var xhr = new XMLHttpRequest();
    var result;
    xhr.open("GET", "https://" + host + "/v1/monitoring/" + Name, false);
    xhr.onloadend = (e) => {result = JSON.parse(e.target.response);};
    xhr.send();
    return result;
}


    var MetricsDiv = document.getElementById('metrics');
    var metricsList = getMetricsList();

    metricsList.forEach((metric)=>{
        var div = document.createElement('div');
        div.id = metric;
        div.style = "width:600px;height:250px;";
        var data = getMetric(metric);

        switch(metric){
            case "ram":
            // {"1496015959586844":{"atom":809913,"atom_used":808562,"binary":224560,"code":21210229,"ets":1147304,"processes":10309960,"processes_used":10308688,"system":32117608,"total":42427568}}
            var x=[];
            var y = {};
            var fields = ["atom", "atom_used", "binary", "code", "ets", "processes", "processes_used", "system", "total"];
            fields.forEach((name)=>{y[name] = [];});
            for (var timestamp in data) {
                if (data.hasOwnProperty(timestamp)) {
                    x.push(parseInt(timestamp));
                    y.atom.push(parseInt(data[timestamp].atom));
                    y.atom_used.push(parseInt(data[timestamp].atom_used));
                    y.binary.push(parseInt(data[timestamp].binary));
                    y.code.push(parseInt(data[timestamp].code));
                    y.ets.push(parseInt(data[timestamp].ets));
                    y.processes.push(parseInt(data[timestamp].processes));
                    y.processes_used.push(parseInt(data[timestamp].processes_used));
                    y.system.push(parseInt(data[timestamp].system));
                    y.total.push(parseInt(data[timestamp].total));
                }
            };

            fields.forEach((name)=>{
                var tmp_div = document.createElement('div');
                tmp_div.id = metric + "_" + name;
                tmp_div.style = "width:600px;height:250px;";
                var layout = {
                    xaxis: {title: 'time'},
                    yaxis: {title: 'usage'},
                };
                Plotly.plot(tmp_div, [{
                    x: x,
                    y: y[name]}], {
                        title: name,
                        xaxis: {title: 'time'},
                        yaxis: {title: 'usage'}
                    });
                MetricsDiv.appendChild(tmp_div);
            });
            break;
        }
    });


                </script>
        </body>
</html>
